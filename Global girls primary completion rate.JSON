{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Basic education for girls: improvements since 2000",
    "subtitle": "Source: World Bank.",
    "fontSize": 18,
    "anchor": "start"
  },
  "width": 700,
  "height": 450,
  "data": {
    "url": "https://raw.githubusercontent.com/37099/37099.github.io/refs/heads/main/Global%20female%20primary%20grad%20rates%20time%20series.csv"
  },
  "transform": [
    {
      "fold": ["2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022", "2023", "2024"],
      "as": ["year", "completion_rate"]
    },
    {
      "calculate": "datum.completion_rate == '..' ? null : toNumber(datum.completion_rate)",
      "as": "rate"
    },
    {
      "filter": "datum.rate != null && datum.rate <= 110"
    },
    {
      "calculate": "toNumber(datum.year)",
      "as": "year_num"
    }
  ],
  "layer": [
    {
      "mark": {"type": "line", "strokeWidth": 1, "opacity": 0.25, "color": "#d5d8dc"},
      "transform": [{"filter": "datum['Country Name'] != 'Morocco' && datum['Country Name'] != 'Chad'"}],
      "encoding": {
        "x": {
          "field": "year_num", 
          "type": "quantitative", 
          "title": "Year", 
          "scale": {"domain": [2000, 2024]},
          "axis": {"format": "d"}
        },
        "y": {"field": "rate", "type": "quantitative", "title": "Primary Completion Rate (%)", "scale": {"domain": [0, 110]}},
        "detail": {"field": "Country Name"}
      }
    },
    {
      "mark": {"type": "line", "strokeWidth": 3, "color": "#1e7e34"},
      "transform": [{"filter": "datum['Country Name'] == 'Morocco'"}],
      "encoding": {
        "x": {"field": "year_num", "type": "quantitative"},
        "y": {"field": "rate", "type": "quantitative"}
      }
    },
    {
      "mark": {"type": "line", "strokeWidth": 2, "color": "#e74c3c"},
      "transform": [{"filter": "datum['Country Name'] == 'Chad'"}],
      "encoding": {
        "x": {"field": "year_num", "type": "quantitative"},
        "y": {"field": "rate", "type": "quantitative"}
      }
    },
    {
      "mark": {"type": "line", "strokeWidth": 5, "color": "#27ae60"},
      "transform": [{"aggregate": [{"op": "mean", "field": "rate", "as": "avg_rate"}], "groupby": ["year_num"]}],
      "encoding": {
        "x": {"field": "year_num", "type": "quantitative"},
        "y": {"field": "avg_rate", "type": "quantitative"}
      }
    },
    {
      "mark": {"type": "text", "align": "right", "dx": -1, "dy": 10, "fontSize": 13, "fontWeight": "bold", "color": "#27ae60"},
      "transform": [
        {"aggregate": [{"op": "mean", "field": "rate", "as": "avg_rate"}], "groupby": ["year_num"]},
        {"filter": "datum.year_num == 2000"}
      ],
      "encoding": {
        "x": {"field": "year_num", "type": "quantitative"},
        "y": {"field": "avg_rate", "type": "quantitative"},
        "text": {"field": "avg_rate", "type": "quantitative", "format": ".0f"}
      }
    },
    {
      "mark": {"type": "text", "align": "right", "dy": 10, "fontSize": 13, "fontWeight": "bold", "color": "#27ae60"},
      "transform": [
        {"aggregate": [{"op": "mean", "field": "rate", "as": "avg_rate"}], "groupby": ["year_num"]},
        {"filter": "datum.year_num == 2024"}
      ],
      "encoding": {
        "x": {"field": "year_num", "type": "quantitative"},
        "y": {"field": "avg_rate", "type": "quantitative"},
        "text": {"field": "avg_rate", "type": "quantitative", "format": ".0f"}
      }
    },
    {
      "mark": {"type": "text", "align": "left", "dx": 5, "dy": -5, "fontSize": 12, "fontWeight": "bold", "color": "#1e7e34"},
      "transform": [
        {"filter": "datum['Country Name'] == 'Morocco'"},
        {"filter": "datum.year_num == 2024"}
      ],
      "encoding": {
        "x": {"field": "year_num", "type": "quantitative"},
        "y": {"field": "rate", "type": "quantitative"},
        "text": {"value": "Morocco"}
      }
    },
    {
      "mark": {"type": "text", "align": "left", "dx": 5, "dy": -5, "fontSize": 12, "fontWeight": "bold", "color": "#e74c3c"},
      "transform": [
        {"filter": "datum['Country Name'] == 'Chad'"},
        {"aggregate": [{"op": "argmax", "field": "year_num", "as": "latest"}]}
      ],
      "encoding": {
        "x": {"field": "latest.year_num", "type": "quantitative"},
        "y": {"field": "latest.rate", "type": "quantitative"},
        "text": {"value": "Chad"}
      }
    },
    {
      "mark": {"type": "text", "align": "left", "dx": 5, "dy": -5, "fontSize": 12, "fontWeight": "bold", "color": "#27ae60"},
      "transform": [
        {"aggregate": [{"op": "mean", "field": "rate", "as": "avg_rate"}], "groupby": ["year_num"]},
        {"filter": "datum.year_num == 2024"}
      ],
      "encoding": {
        "x": {"field": "year_num", "type": "quantitative"},
        "y": {"field": "avg_rate", "type": "quantitative"},
        "text": {"value": "Global average"}
      }
    }
  ]
}