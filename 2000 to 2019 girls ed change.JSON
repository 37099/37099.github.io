{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Basic Education for Girls: Change from 2000 to 2019",
    "subtitle": "Each line represents one country | Green = Improved | Red = Worsened | Source: World Bank",
    "fontSize": 18,
    "anchor": "start"
  },
  "width": 500,
  "height": 800,
  "config": {
    "view": {
      "strokeOpacity": 0
    }
  },
  "data": {
    "url": "https://raw.githubusercontent.com/37099/37099.github.io/refs/heads/main/Global%20female%20primary%20grad%20rates%20time%20series.csv"
  },
  "transform": [
    {"filter": "datum['Country Name'] != 'Georgia'"},
    {
      "fold": ["2000", "2019"],
      "as": ["year", "completion_rate"]
    },
    {
      "calculate": "datum.completion_rate == '..' ? null : toNumber(datum.completion_rate)",
      "as": "rate"
    },
    {"filter": "datum.rate != null && datum.rate <= 100"},
    {"calculate": "toNumber(datum.year)", "as": "year_num"},
    {
      "joinaggregate": [
        {"op": "max", "field": "rate", "as": "rate_2000"}
      ],
      "groupby": ["Country Name"]
    },
    {
      "joinaggregate": [
        {"op": "min", "field": "rate", "as": "rate_2019"}
      ],
      "groupby": ["Country Name"]
    },
    {
      "calculate": "datum.year_num == 2000 ? datum.rate : null",
      "as": "temp_2000"
    },
    {
      "calculate": "datum.year_num == 2019 ? datum.rate : null",
      "as": "temp_2019"
    },
    {
      "joinaggregate": [
        {"op": "max", "field": "temp_2000", "as": "actual_2000"},
        {"op": "max", "field": "temp_2019", "as": "actual_2019"}
      ],
      "groupby": ["Country Name"]
    },
    {"filter": "datum.actual_2000 != null && datum.actual_2019 != null"},
    {
      "calculate": "datum.actual_2019 > datum.actual_2000 ? 'Improved' : (datum.actual_2019 < datum.actual_2000 ? 'Worsened' : 'No Change')",
      "as": "status"
    }
  ],
  "encoding": {
    "x": {
      "field": "year_num",
      "type": "ordinal",
      "title": null,
      "axis": {
        "labelAngle": 0,
        "labelFontSize": 14,
        "labelFontWeight": "bold",
        "domain": false,
        "ticks": false
      },
      "scale": {"paddingOuter": 0.5, "paddingInner": 1}
    },
    "y": {
      "field": "rate",
      "type": "quantitative",
      "title": "Primary Completion Rate (%)",
      "scale": {"domain": [0, 105]},
      "axis": {
        "grid": false,
        "domain": false,
        "ticks": false
      }
    }
  },
  "layer": [
    {
      "mark": {
        "type": "line",
        "strokeWidth": 0.8,
        "opacity": 0.4
      },
      "transform": [
        {"filter": "datum.status == 'Improved'"}
      ],
      "encoding": {
        "detail": {"field": "Country Name", "type": "nominal"},
        "color": {"value": "#1e8449"}
      }
    },
    {
      "mark": {
        "type": "line",
        "strokeWidth": 2,
        "opacity": 0.5
      },
      "transform": [
        {"filter": "datum.status == 'Worsened'"}
      ],
      "encoding": {
        "detail": {"field": "Country Name", "type": "nominal"},
        "color": {"value": "#ec7063"}
      }
    },
    {
      "mark": {
        "type": "line",
        "strokeWidth": 1,
        "opacity": 0.3
      },
      "transform": [
        {"filter": "datum.status == 'No Change'"}
      ],
      "encoding": {
        "detail": {"field": "Country Name", "type": "nominal"},
        "color": {"value": "#95a5a6"}
      }
    },
    {
      "mark": {
        "type": "point",
        "filled": true,
        "size": 40,
        "opacity": 0.3
      },
      "transform": [
        {"filter": "datum.status == 'Improved'"},
        {"filter": "datum.year_num == 2019"}
      ],
      "encoding": {
        "color": {"value": "#1e8449"},
        "tooltip": [
          {"field": "Country Name", "type": "nominal", "title": "Country"},
          {"field": "actual_2000", "type": "quantitative", "title": "2000 Rate (%)", "format": ".1f"},
          {"field": "actual_2019", "type": "quantitative", "title": "2019 Rate (%)", "format": ".1f"},
          {"calculate": "datum.actual_2019 - datum.actual_2000", "title": "Change", "format": "+.1f"}
        ]
      }
    },
    {
      "mark": {
        "type": "point",
        "filled": true,
        "size": 80,
        "opacity": 0.7
      },
      "transform": [
        {"filter": "datum.status == 'Worsened'"},
        {"filter": "datum.year_num == 2019"}
      ],
      "encoding": {
        "color": {"value": "#ec7063"},
        "tooltip": [
          {"field": "Country Name", "type": "nominal", "title": "Country"},
          {"field": "actual_2000", "type": "quantitative", "title": "2000 Rate (%)", "format": ".1f"},
          {"field": "actual_2019", "type": "quantitative", "title": "2019 Rate (%)", "format": ".1f"},
          {"calculate": "datum.actual_2019 - datum.actual_2000", "title": "Change", "format": ".1f"}
        ]
      }
    },
    {
      "data": {
        "values": [
          {"Country Name": "Syrian Arab Republic", "year_num": 2000, "rate": 89},
          {"Country Name": "Syrian Arab Republic", "year_num": 2019, "rate": 50}
        ]
      },
      "mark": {
        "type": "line",
        "strokeWidth": 2,
        "opacity": 0.5
      },
      "encoding": {
        "x": {"field": "year_num", "type": "ordinal"},
        "y": {"field": "rate", "type": "quantitative"},
        "detail": {"field": "Country Name", "type": "nominal"},
        "color": {"value": "#ec7063"}
      }
    },
    {
      "data": {
        "values": [
          {"Country Name": "Syrian Arab Republic", "year_num": 2019, "rate": 50}
        ]
      },
      "mark": {
        "type": "point",
        "filled": true,
        "size": 80,
        "opacity": 0.7
      },
      "encoding": {
        "x": {"field": "year_num", "type": "ordinal"},
        "y": {"field": "rate", "type": "quantitative"},
        "color": {"value": "#ec7063"},
        "tooltip": [
          {"field": "Country Name", "type": "nominal", "title": "Country"},
          {"datum": 89, "title": "2000 Rate (%)"},
          {"datum": 50, "title": "2019 Rate (%)"},
          {"datum": -39, "title": "Change"}
        ]
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/37099/37099.github.io/refs/heads/main/Global%20female%20primary%20grad%20rates%20time%20series.csv"
      },
      "transform": [
        {"filter": "datum['Country Name'] != 'Georgia'"},
        {
          "fold": ["2000", "2019"],
          "as": ["year", "completion_rate"]
        },
        {
          "calculate": "datum.completion_rate == '..' ? null : toNumber(datum.completion_rate)",
          "as": "rate"
        },
        {"filter": "datum.rate != null && datum.rate <= 100"},
        {"calculate": "toNumber(datum.year)", "as": "year_num"},
        {
          "aggregate": [{"op": "mean", "field": "rate", "as": "avg_rate"}],
          "groupby": ["year_num"]
        }
      ],
      "mark": {
        "type": "line",
        "strokeWidth": 4,
        "color": "#000000"
      },
      "encoding": {
        "x": {"field": "year_num", "type": "ordinal"},
        "y": {"field": "avg_rate", "type": "quantitative"},
        "tooltip": [
          {"field": "year_num", "type": "ordinal", "title": "Year"},
          {"field": "avg_rate", "type": "quantitative", "title": "Global Average (%)", "format": ".1f"}
        ]
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/37099/37099.github.io/refs/heads/main/Global%20female%20primary%20grad%20rates%20time%20series.csv"
      },
      "transform": [
        {"filter": "datum['Country Name'] != 'Georgia'"},
        {
          "fold": ["2019"],
          "as": ["year", "completion_rate"]
        },
        {
          "calculate": "datum.completion_rate == '..' ? null : toNumber(datum.completion_rate)",
          "as": "rate"
        },
        {"filter": "datum.rate != null && datum.rate <= 100"},
        {"calculate": "toNumber(datum.year)", "as": "year_num"},
        {
          "aggregate": [{"op": "mean", "field": "rate", "as": "avg_rate"}],
          "groupby": ["year_num"]
        }
      ],
      "mark": {
        "type": "text",
        "align": "left",
        "dx": 10,
        "fontSize": 12,
        "fontWeight": "bold",
        "color": "#000000"
      },
      "encoding": {
        "x": {"field": "year_num", "type": "ordinal"},
        "y": {"field": "avg_rate", "type": "quantitative"},
        "text": {"value": "Global average"}
      }
    }
  ]
}